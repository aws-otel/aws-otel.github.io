---
title: 'OTLP Ingest Collector Configuration'
description:
    This page introduces Collector configuration for OTLP Ingest for the ADOT Collector.
path: '/docs/getting-started/adot-eks-add-on/config-otlp-ingest'
---
The [OpenTelemetry Protocol (OTLP)](https://opentelemetry.io/docs/specs/otlp/) Ingest collector configuration launches a preconfigured OpenTelemetry Collector custom resource 
to ingest trace export calls with the [otlp](https://github.com/open-telemetry/opentelemetry-collector/tree/main/receiver/otlpreceiver) receiver. By opting into the 
[available pipeline](/docs/getting-started/adot-eks-add-on/config-otlp-ingest/#otlp-ingest-pipelines)
you can control where the collected traces are sent. 

## Prerequisites

### Setup an IAM role to associate with the service account

An IAM Role with the following policies must be created for the following Kubernetes 
service account and namespace. 

| Service Account Name       | Namespace | IAM Policies |
| -------------------------- | --------- | ------------ |
| <nobr>adot-col-otlp-ingest</nobr> | <nobr>opentelemetry-operator-system</nobr> | AWSXrayWriteOnlyAccess |
**Note:** Only attach the minimum set of policies necessary for your advanced configuration.

The [IAM Roles for Service Accounts documentation (IRSA)](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.htmlhttps://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html) contains instructions for creating the IAM
role. The following examples will use [eksctl](https://eksctl.io/usage/iamserviceaccounts/https://eksctl.io/usage/iamserviceaccounts/) to achieve this. 

To create this IAM role, run the following command:

```console
eksctl create iamserviceaccount \
    --name adot-col-otlp-ingest \
    --namespace opentelemetry-operator-system \
    --cluster <your_cluster_name> \
    --attach-policy-arn arn:aws:iam::aws:policy/AWSXrayWriteOnlyAccess \
    --approve \
    --role-only
```

This IAM role generated by the above command needs to be inserted into the annotations 
field of the advanced configuration as seen below:
```yaml
collector:
  otlpIngest:
    serviceAccount:
      annotations:
        eks.amazonaws.com/role-arn: <iam_role_arn>
```

## OTLP Ingest pipelines
The following pipelines are available for the OTLP Ingest preconfigured custom resource.
Pipelines can be enabled by setting their `enabled` field to `true`. 

### Traces

- #### xray
Traces collected by OTLP receiver are sent to AWS X-Ray.

### OTLP Ingest Advanced Configuration pipeline
```yaml
collector:
  otlpIngest:
    serviceAccount:
      annotations:
        eks.amazonaws.com/role-arn: <iam_role_arn>
    pipelines:
      traces:
        xray:
          enabled: true
```

## OTLP Ingest configurable values

Shown below is the complete list of configurable fields, along with their
default values, for the otlpIngest resource.


```yaml
collector:
  otlpIngest:
    resources:
      limits:
        cpu: 1000m
        memory: 750Mi
      requests:
        cpu: 300m
        memory: 512Mi
    serviceAccount:
      annotations:
    pipelines:
      traces:
        xray:
          enabled: false
```
*Note that in Fargate, resource requests and limits must be equal, see 
this [troubleshooting guide](https://docs.aws.amazon.com/eks/latest/userguide/troubleshooting-adot.html) for more information.

## [Previous Topic: Add-on Advanced Configuration: Collector Deployment](/docs/getting-started/adot-eks-add-on/add-on-configuration-collector-deployment)

## Related Topics:

### [Collector Configuration for Prometheus Metrics](/docs/getting-started/adot-eks-add-on/config-prometheus-metrics)

### [Collector Configuration for Container Logs](/docs/getting-started/adot-eks-add-on/config-container-logs)

## [Next Topic: Updating and Cleanup](/docs/getting-started/adot-eks-add-on/update-and-cleanup)
