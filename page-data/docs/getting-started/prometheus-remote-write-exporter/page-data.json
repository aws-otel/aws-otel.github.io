{
    "componentChunkName": "component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js",
    "path": "/docs/getting-started/prometheus-remote-write-exporter",
    "result": {"data":{"mdx":{"id":"29ad1305-d261-589d-a787-76f5dda4e14b","excerpt":"In order to scrape and export metrics to your AWS Managed Service for Prometheus (AMP) instance, you can use either the AWS Distro for \nthe OpenTelemetry…","fields":{"slug":"/docs/getting-started/prometheus-remote-write-exporter/"},"frontmatter":{"title":"Getting Started with Prometheus Remote Write Exporter for AMP","description":"In this Getting Started guide, we’ll show you how to configure the ADOT Collector to scrape from a Prometheus-instrumented application, and send metrics to Amazon Managed Service for Prometheus (AMP).","image":null,"disableTableOfContents":null},"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"Getting Started with Prometheus Remote Write Exporter for AMP\",\n  \"description\": \"In this Getting Started guide, we’ll show you how to configure the ADOT Collector to scrape from a Prometheus-instrumented application, and send metrics to Amazon Managed Service for Prometheus (AMP).\",\n  \"path\": \"/docs/getting-started/prometheus-remote-write-exporter\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"In order to scrape and export metrics to your AWS Managed Service for Prometheus (AMP) instance, you can use either the AWS Distro for\\nthe OpenTelemetry Collector (ADOT Collector) or a standard vanilla Prometheus server.\"), mdx(\"p\", null, \"In this Getting Started guide, we\\u2019ll show you how to configure the ADOT Collector to scrape from a Prometheus-instrumented application,\\nand send metrics to the AWS Managed Service for Prometheus (AMP).\"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"before-you-begin\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#before-you-begin\",\n    \"aria-label\": \"before you begin permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Before you Begin\"), mdx(\"p\", null, \"The ADOT-AMP pipeline enables us to use the ADOT Collector to scrape a Prometheus-instrumented application, and send the scraped metrics\\nto AWS Managed Service for Prometheus (AMP). \"), mdx(\"img\", {\n    src: prometheusPipelineEKSImg,\n    alt: \"Diagram\",\n    style: {\n      \"margin\": \"30px 0\"\n    }\n  }), mdx(\"p\", null, \"The ADOT-AMP pipeline includes two OpenTelemetry Collector components specific to Prometheus \\u2014 the Prometheus Receiver and the Prometheus\\nRemote Write Exporter. \"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"setup-guides-for-different-environments\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#setup-guides-for-different-environments\",\n    \"aria-label\": \"setup guides for different environments permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Setup Guides for Different Environments\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"/docs/getting-started/prometheus-remote-write-exporter/eks\"\n  }, \"Setting up the ADOT Collector for EKS\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"/docs/getting-started/prometheus-remote-write-exporter/ecs\"\n  }, \"Setting up the ADOT Collector for ECS\"))), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"components-in-our-pipeline\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#components-in-our-pipeline\",\n    \"aria-label\": \"components in our pipeline permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Components in our Pipeline\"), mdx(\"h3\", {\n    \"id\": \"prometheus-receiver\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#prometheus-receiver\",\n    \"aria-label\": \"prometheus receiver permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Prometheus Receiver\"), mdx(\"p\", null, \"The Prometheus Receiver supports the full set of Prometheus scraping and re-labeling configurations described\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://prometheus.io/docs/prometheus/latest/configuration/configuration/\"\n  }, \"here\"), \". You should be able to directly paste in these configurations into your\\nADOT Collector configurations. \"), mdx(\"p\", null, \"The configuration for the Prometheus Receiver will include your service discovery, scraping configurations, and re-labeling configurations. The\\nreceiver configurations will look like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"receivers:\\n  prometheus:\\n    config:\\n      [Your Prometheus configurations]\\n\")), mdx(\"p\", null, \"An example configuration is shown below. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"receivers:\\n  prometheus:\\n    config:\\n      global:\\n        scrape_interval: 1m\\n        scrape_timeout: 10s\\n        \\n      scrape_configs:\\n      - job_name: kubernetes-service-endpoints\\n        sample_limit: 10000\\n        kubernetes_sd_configs:\\n        - role: endpoints\\n\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note:\"), \" To perform Kubernetes service discovery, you will need to set up the proper permissions and RBAC authorization for the service account\\n(to allow it to access the Kubernetes API). Please refer to the Permissions section in the\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/docs/getting-started/advanced-prometheus-remote-write-configurations\"\n  }, \"advanced configurations doc\"), \".\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note: If you have existing Prometheus configurations, you will need to replace the \", mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"$\"), \" characters with \", mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"$$\"), \" to avoid having the value replaced with environment variables. \"), \"\\nThis is especially important for the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"replacement\"), \" value of the relabel_configurations. For instance, the following configuration for relabel_configurations below \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"relabel_configs:\\n- source_labels: [__meta_kubernetes_ingress_scheme,__address__,__meta_kubernetes_ingress_path]\\n  regex: (.+);(.+);(.+)\\n  replacement: ${1}://${2}${3}\\n  target_label: __param_target\\n\")), mdx(\"p\", null, \"would become \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"relabel_configs:\\n- source_labels: [__meta_kubernetes_ingress_scheme,__address__,__meta_kubernetes_ingress_path]\\n  regex: (.+);(.+);(.+)\\n  replacement: $${1}://${2}${3}\\n  target_label: __param_target\\n\")), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"prometheus-remote-write-exporter\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#prometheus-remote-write-exporter\",\n    \"aria-label\": \"prometheus remote write exporter permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Prometheus Remote Write Exporter\"), mdx(\"p\", null, \"The configuration for the Prometheus Remote Write Exporter is a lot simpler than the Prometheus receiver. At this stage in the pipeline, metrics\\nhave already been ingested, and we\\u2019re ready to export this data to AMP. The minimum requirement for a successful configuration to communicate with AMP is as follows:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"extensions:\\n  sigv4auth:\\n    service: \\\"aps\\\"\\n    region: \\\"user-region\\\"\\n\\nexporters:\\n  prometheusremotewrite:\\n    endpoint: \\\"https://aws-managed-prometheus-endpoint/v1/api/remote_write\\\"\\n    auth:\\n      authenticator: sigv4auth\\n\")), mdx(\"p\", null, \"This configuration sends an HTTPS request that is signed by AWS SigV4 using the credentials that are set up from the prerequisites section.\\nThis is enabled by using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"sigv4auth\"), \" extension. It is mandatory that customers specify the service to be \\u201Caps\\u201D.\"), mdx(\"p\", null, \"Regardless of the method of deployment, the ADOT Collector must have access to one of the listed options in the\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html\"\n  }, \"default AWS credentials chain\"), \". The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"sigv4auth\"), \"\\nextension depends on the AWS Go SDK and uses it to fetch credentials and authenticate. You must ensure that these credentials have remote writing\\npermissions to AMP (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"aps:RemoteWrite\"), \").\"), mdx(\"h3\", {\n    \"id\": \"name-normalization\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#name-normalization\",\n    \"aria-label\": \"name normalization permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Name normalization\"), mdx(\"p\", null, \"Starting with ADOT collector v0.35.0, this component will normalize metric names to follow \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://prometheus.io/docs/practices/naming/\"\n  }, \"Prometheus metric naming best practices\"), \". You can control this behavior\\nthrough the parameter \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"add_metric_suffixes\"), \". If this parameter is set to false, no name normalization will happen.\"), mdx(\"p\", null, \"Example:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"  prometheusremotewrite:\\n    endpoint: http://example.com\\n    add_metric_suffixes: false  # <-- Disable normalization\\n    resource_to_telemetry_conversion:\\n      enabled: true\\n    auth:\\n      authenticator: sigv4auth\\n\")), mdx(\"p\", null, \"For more details, please refer to our \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/docs/migrating-to-collector-v0.35.0\"\n  }, \"migration guide\"), \".\"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"conclusion\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#conclusion\",\n    \"aria-label\": \"conclusion permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Conclusion\"), mdx(\"p\", null, \"This document has gone over what the basic requirements are to get set up with the ADOT Collector to collect and export Prometheus metrics to AMP.\\nWith this, you should be able to use the aforementioned tools to have a clean solution to observability on your software systems. \"), mdx(\"p\", null, \"For more advanced configurations with the ADOT Collector-AMP, please take a look \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/docs/getting-started/advanced-prometheus-remote-write-configurations\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"We would love to hear more common configuration scenarios or improvements to this documentation from you! Please submit an issue\\non the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/aws-observability/aws-otel-community\"\n  }, \"aws-otel community\"), \" to let us know.\"));\n}\n;\nMDXContent.isMDXComponent = true;","headings":[{"depth":2,"value":"Before you Begin"},{"depth":2,"value":"Setup Guides for Different Environments"},{"depth":2,"value":"Components in our Pipeline"},{"depth":3,"value":"Prometheus Receiver"},{"depth":3,"value":"Prometheus Remote Write Exporter"},{"depth":3,"value":"Name normalization"},{"depth":2,"value":"Conclusion"}]}},"pageContext":{"slug":"/docs/getting-started/prometheus-remote-write-exporter/","repositoryEditUrl":"https://github.com/rocketseat/gatsby-themes/tree/main/examples/gatsby-theme-docs/src/docs/getting-started/prometheus-remote-write-exporter.mdx","repositoryProvider":"GitHub"}},
    "staticQueryHashes": ["2501019404","973074209"]}