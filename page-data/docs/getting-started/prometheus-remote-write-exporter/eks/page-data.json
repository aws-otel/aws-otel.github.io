{
    "componentChunkName": "component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js",
    "path": "/docs/getting-started/prometheus-remote-write-exporter/eks",
    "result": {"data":{"mdx":{"id":"3841a3d9-6df6-5863-9a49-b99b3e72d391","excerpt":"In this guide, we'll enable Prometheus collection for an EKS cluster on EC2 and an EKS cluster on Fargate. In this scenario, we will use the Prometheus Receiverâ€¦","fields":{"slug":"/docs/getting-started/prometheus-remote-write-exporter/eks/"},"frontmatter":{"title":"Basic Kubernetes/EKS Configuration for AMP","description":"In this guide, we'll enable Prometheus collection on an EKS cluster. In this scenario, we will use the Prometheus Receiver to perform service discovery in an EKS cluster and metric scraping.","image":null,"disableTableOfContents":null},"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"Basic Kubernetes/EKS Configuration for AMP\",\n  \"description\": \"In this guide, we'll enable Prometheus collection on an EKS cluster. In this scenario, we will use the Prometheus Receiver to perform service discovery in an EKS cluster and metric scraping.\",\n  \"path\": \"/docs/getting-started/prometheus-remote-write-exporter/eks\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"In this guide, we'll enable Prometheus collection for an EKS cluster on EC2 and an EKS cluster on Fargate. In this scenario, we will use the Prometheus Receiver to perform service discovery in\\nan EKS cluster and metric scraping. We will scrape from an application that provides us with some example Prometheus metrics. Notice that this setup\\nwill also work for an on-premise Kubernetes configuration.\"), mdx(\"p\", null, \"For information about advanced configurations and how to scrape Kubernetes infrastructure with the ADOT Collector-AMP pipeline, please take a look\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/docs/getting-started/advanced-prometheus-remote-write-configurations\"\n  }, \"here\")), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"service-discovery\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#service-discovery\",\n    \"aria-label\": \"service discovery permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Service Discovery\"), mdx(\"p\", null, \"The Prometheus Receiver can be configured using your existing\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://prometheus.io/docs/prometheus/latest/configuration/configuration/\"\n  }, \"Prometheus configurations\"), \" to perform service discovery and metric\\nscraping. There are many possible configurations to discover monitored targets including Kubernetes service discovery (kubernetes_sd_config)\\nand static hosts (static_config). Note that the Prometheus Receiver will scrape metrics in the Prometheus exposition format. Any applications\\nor endpoints that you want to scrape should be configured with the Prometheus client library.\"), mdx(\"p\", null, \"The Prometheus Remote Write Exporter will use the remote_write endpoint to send the scraped metrics to an AMP instance. The HTTPs requests\\nused to export data will be signed with \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html\"\n  }, \"AWS SigV4\"), \", AWS\\u2019\\nauthentication protocol for secure authentication. This is done using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"sigv4auth\"), \" extension.\"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"prerequisites\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#prerequisites\",\n    \"aria-label\": \"prerequisites permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Prerequisites\"), mdx(\"p\", null, \"Before getting started, you will need to set up the following components:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"An AMP workspace should be set up. Guides for this can be found \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://docs.aws.amazon.com/prometheus/latest/userguide/what-is-Amazon-Managed-Service-Prometheus.html\"\n  }, \"here\"), \". \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"A Kubernetes or EKS cluster. The EKS cluster can be on either EC2 or Fargate. If you need to set up an EKS cluster, please use the following \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html\"\n  }, \"guide\"), \".\\nYou can check the name of the active context/cluster using this command \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"kubectl config current-context\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If you are setting up the ADOT Collector of AWS EKS, you will need to \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://docs.aws.amazon.com/prometheus/latest/userguide/set-up-irsa.html#set-up-irsa-ingest\"\n  }, \"set up IAM roles for service accounts for the ingestion of metrics from Amazon EKS clusters\"), \".\\nPlease follow the \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"To set up IRSA for ingestion into AMP\"), \" section. This section will create a IAM role for the service account that we will use for the\\nADOT Collector to scrape and export metrics.\")), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"editing-the-trust-policy\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#editing-the-trust-policy\",\n    \"aria-label\": \"editing the trust policy permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Editing the Trust Policy\"), mdx(\"p\", null, \"If you are setting up the ADOT Collector of AWS EKS, you will need to edit the trust policy created in the prerequisites.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Go to your IAM Management Console to find the \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"amp-iamproxy-ingest-role\"), \" that was created in the prerequisites. \")), mdx(\"img\", {\n    src: proxyIngestRoleEKSImg,\n    alt: \"Diagram\",\n    style: {\n      \"margin\": \"30px 0\"\n    }\n  }), mdx(\"ol\", {\n    \"start\": 2\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Go to trust relationships and click \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Edit trust relationship.\"))), mdx(\"img\", {\n    src: proxyIngestRoleTrustRelationshipEKSImg,\n    alt: \"Diagram\",\n    style: {\n      \"margin\": \"30px 0\"\n    }\n  }), mdx(\"ol\", {\n    \"start\": 3\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Locate the string below inside the existing trust policy. \")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"  \\\"system:serviceaccount:<your_prometheus_workspace>:amp-iamproxy-ingest-service-account\\\"\\n\")), mdx(\"ol\", {\n    \"start\": 4\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Change the namespace for the service account to \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"adot-col\"), \". The resulting string should reflect the example below: \")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"  \\\"system:serviceaccount:adot-col:amp-iamproxy-ingest-service-account\\\"\\n\")), mdx(\"ol\", {\n    \"start\": 5\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Please make sure the following permissions policy is attached to the IAM role above:\")), mdx(\"img\", {\n    src: proxyIngestRolePoliciesEKSImg,\n    alt: \"Diagram\",\n    style: {\n      \"margin\": \"30px 0\"\n    }\n  }), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"sample-app\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#sample-app\",\n    \"aria-label\": \"sample app permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Sample App\"), mdx(\"p\", null, \"We will be using a simple sample app that is used for the integration tests of this pipeline. You can find the sample app \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/aws-observability/aws-otel-community\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"First, fork the repository. Then clone the repository and run the following commands:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ cd ./sample-apps/prometheus-sample-app\\n$ docker build . -t prometheus-sample-app:latest\\n\")), mdx(\"p\", null, \"In order to use this Docker image for Kubernetes, we need to push this image to a registry. You will need to push your image to your Amazon ECR or DockerHub registry. \"), mdx(\"p\", null, \"To deploy the sample app in EKS, copy this Kubernetes configuration and apply it. Make sure to use the latest image that was pushed.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ curl https://raw.githubusercontent.com/aws-observability/aws-otel-collector/main/examples/eks/aws-prometheus/prometheus-sample-app.yaml -o prometheus-sample-app.yaml\\n\")), mdx(\"p\", null, \"Add your image reference to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"prometheus-sample-app.yaml\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ kubectl apply -f prometheus-sample-app.yaml\\n\")), mdx(\"p\", null, \"You can use the following command to verify that the sample app has started:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ kubectl get all -n aoc-prometheus-pipeline-demo\\nNAME                                        READY   STATUS    RESTARTS   AGE\\npod/prometheus-sample-app-6bfd56b57-8mzsb   1/1     Running   0          15m\\n\\nNAME                                    TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE\\nservice/prometheus-sample-app-service   NodePort   10.100.246.31   <none>        8080:31653/TCP   15m\\n\\nNAME                                    READY   UP-TO-DATE   AVAILABLE   AGE\\ndeployment.apps/prometheus-sample-app   1/1     1            1           15m\\n\\nNAME                                              DESIRED   CURRENT   READY   AGE\\nreplicaset.apps/prometheus-sample-app-6bfd56b57   1         1         1       15m\\n\")), mdx(\"p\", null, \"Any applications that you want to scrape should be instrumented with a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://prometheus.io/docs/instrumenting/clientlibs/\"\n  }, \"Prometheus client\"), \"\\n(this exposes Prometheus exposition metrics to a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/metrics\"), \" endpoint). This is done in the sample app as well.\"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"aws-distro-for-opentelemetry-adot-collector-setup\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#aws-distro-for-opentelemetry-adot-collector-setup\",\n    \"aria-label\": \"aws distro for opentelemetry adot collector setup permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"AWS Distro for OpenTelemetry (ADOT) Collector Setup\"), mdx(\"p\", null, \"To start a default instance of the Collector, we have provided an example template configuration. This template will deploy the ADOT Collector as a DaemonSet.\"), mdx(\"p\", null, \"In this example, the ADOT Collector configurations uses Prometheus\\u2019s Kubernetes service discovery in order to automatically find\\nthe sample app endpoint. An annotation (scrape=true) is used to determine which target endpoints to scrape. (This allows the ADOT Collector\\nto distinguish between our sample app endpoint from kube-system endpoints within your cluster.) Feel free to remove this from the relabel\\nconfigurations if you would like to scrape a different application.\"), mdx(\"p\", null, \"To pull the Kubernetes configuration for ADOT Collector:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ curl https://raw.githubusercontent.com/aws-observability/aws-otel-collector/main/examples/eks/aws-prometheus/prometheus-daemonset.yaml -o eks-prometheus-daemonset.yaml\\n\")), mdx(\"p\", null, \"You will have to change the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<YOUR_ENDPOINT>\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<YOUR_REGION>\"), \" to correspond with your own AMP workspace. The changes should be with respect to the Prometheus Remote Write Exporter\\u2019s configuration and the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"sigv4auth\"), \" extension's configuration. \"), mdx(\"p\", null, \"For Example:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"extensions:\\n  sigv4auth:\\n    service: \\\"aps\\\"\\n    region: \\\"us-west-2\\\"\\n\\nexporters:\\n  prometheusremotewrite:\\n    endpoint: \\\"https://aps-workspaces.us-west-2.amazonaws.com/workspaces/ws-d26e36bf-361j-480c-94f0-54bd7370f997/api/v1/remote_write\\\"\\n    auth:\\n      authenticator: sigv4auth\\n\")), mdx(\"p\", null, \"You\\u2019ll also need to change \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<YOUR_ACCOUNT_ID>\"), \" (in the service account section of the Kubernetes configuration) to your AWS account ID. Now, to deploy the ADOT Collector in EKS, apply this Kubernetes config:\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note: if you are using EKS on Fargate, you will need to change \", mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"DaemonSet\"), \" to \", mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"Deployment\"), \". This is because DaemonSets are not supported by Fargate because there is no concept of nodes in Fargate.\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ kubectl apply -f eks-prometheus-daemonset.yaml\\n\")), mdx(\"p\", null, \"You can verify that the ADOT Collector has started with this command:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ kubectl get pods -n adot-col\\nNAMESPACE              NAME                                         READY   STATUS             RESTARTS   AGE\\nadot-col               adot-collector-7bc7c                         1/1     Running            0          3m17s\\n\")), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"verifying-the-pipeline-works\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#verifying-the-pipeline-works\",\n    \"aria-label\": \"verifying the pipeline works permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Verifying the Pipeline Works\"), mdx(\"p\", null, \"The logging exporter can be used to verify that metrics were scraped by the Prometheus Receiver. This example is already hooked up with the\\nlogging exporter. You can check the logs with these commands:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ kubectl get pods -A\\n$ kubectl logs -n adot-col [name_of_your_adot_collector_pod]\\n\")), mdx(\"p\", null, \"An example of the scraped metrics in the logging exporter:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"Resource labels:\\n     -> service.name: STRING(kubernetes-service-endpoints)\\n     -> host.name: STRING(192.168.16.238)\\n     -> port: STRING(8080)\\n     -> scheme: STRING(http)\\nInstrumentationLibraryMetrics #0\\nMetric #0\\nDescriptor:\\n     -> Name: test_gauge0\\n     -> Description: This is my gauge\\n     -> Unit: \\n     -> DataType: DoubleGauge\\nDoubleDataPoints #0\\nStartTime: 0\\nTimestamp: 1606511460471000000\\nValue: 0.000000\\n\")), mdx(\"p\", null, \"In order to test if AMP received those metrics, we can use the awscurl. This tool allows us to send HTTPs requests through the command line with AWS\\nSigv4 authentication. In order to use this, make sure you have set the correct permissions to query from AMP in your local AWS credentials. Please use\\nthis guide to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/okigan/awscurl\"\n  }, \"install awscurl\"), \".\"), mdx(\"p\", null, \"You can use the following command below to check if a metric was received in AMP. The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AMP_REGION\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AMP_ENDPOINT\"), \" will have to be changed\\ncorresponding to your AMP workspace.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ awscurl --service=\\\"aps\\\" --region=\\\"AMP_REGION\\\" \\\"https://{AMP_ENDPOINT}/api/v1/query?query=adot_test_gauge0\\\"\\n{\\\"status\\\":\\\"success\\\",\\\"data\\\":{\\\"resultType\\\":\\\"vector\\\",\\\"result\\\":[{\\\"metric\\\":{\\\"__name__\\\":\\\"adot_test_gauge0\\\"},\\\"value\\\":[1606512592.493,\\\"16.87214000011479\\\"]}]}}\\n\")), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Note\"), \": \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"we added a \", mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"namespace: adot\"), \" value in the ADOT Collector yaml file to prefix each metric that is exported by ADOT Collector with \", mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"adot_\"), \". \")), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"it-works\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#it-works\",\n    \"aria-label\": \"it works permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"It Works!\"), mdx(\"p\", null, \"If you receive a metric as the response, that means your pipeline setup is successful! This metric has successfully propagated from the sample app into AMP. \"), mdx(\"p\", null, \"Similar pipelines can be configured using the components mentioned above to scrape your Kubernetes cluster and applications. Please refer below for advanced configurations.\"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"cleaning-up\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#cleaning-up\",\n    \"aria-label\": \"cleaning up permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Cleaning up\"), mdx(\"p\", null, \"Run the following commands to clean up your EKS cluster.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, \"$ kubectl delete namespace aoc-prometheus-pipeline-demo\\n$ kubectl delete namespace adot-col\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;","headings":[{"depth":2,"value":"Service Discovery"},{"depth":2,"value":"Prerequisites"},{"depth":2,"value":"Editing the Trust Policy"},{"depth":2,"value":"Sample App"},{"depth":2,"value":"AWS Distro for OpenTelemetry (ADOT) Collector Setup"},{"depth":2,"value":"Verifying the Pipeline Works"},{"depth":2,"value":"It Works!"},{"depth":2,"value":"Cleaning up"}]}},"pageContext":{"slug":"/docs/getting-started/prometheus-remote-write-exporter/eks/","repositoryEditUrl":"https://github.com/rocketseat/gatsby-themes/tree/main/examples/gatsby-theme-docs/src/docs/getting-started/prometheus-remote-write-exporter/eks.mdx","repositoryProvider":"GitHub"}},
    "staticQueryHashes": ["2501019404","973074209"]}