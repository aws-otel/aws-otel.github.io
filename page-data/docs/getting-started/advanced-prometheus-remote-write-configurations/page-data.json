{
    "componentChunkName": "component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js",
    "path": "/docs/getting-started/advanced-prometheus-remote-write-configurations",
    "result": {"data":{"mdx":{"id":"4c079e49-91f9-5a5f-acff-3299fdd823aa","excerpt":"In this guide, we provide some advanced configurations for the AWS Distro for OpenTelemetry (ADOT) Collector-AWS Managed Service \nfor Prometheus (AMP) Pipelineâ€¦","fields":{"slug":"/docs/getting-started/advanced-prometheus-remote-write-configurations/"},"frontmatter":{"title":"Prometheus Remote Write Exporter Advanced Configurations for AMP","description":"In this guide, we provide some advanced configurations for the AWS Distro for OpenTelemetry Collector-AWS Managed Service for Prometheus (AMP) Pipeline.","image":null,"disableTableOfContents":null},"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"Prometheus Remote Write Exporter Advanced Configurations for AMP\",\n  \"description\": \"In this guide, we provide some advanced configurations for the AWS Distro for OpenTelemetry Collector-AWS Managed Service for Prometheus (AMP) Pipeline.\",\n  \"path\": \"/docs/getting-started/advanced-prometheus-remote-write-configurations\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"In this guide, we provide some advanced configurations for the AWS Distro for OpenTelemetry (ADOT) Collector-AWS Managed Service\\nfor Prometheus (AMP) Pipeline. \"), mdx(\"p\", null, \"For an overview on what the pipeline is or for more basic configurations, please take a look at this\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/docs/getting-started/prometheus-remote-write-exporter\"\n  }, \"Getting Started with the AWS Distro for OpenTelemetry Collector-AMP Pipeline in EKS Guide\"), \".\"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"prometheus-receiver-configurations\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#prometheus-receiver-configurations\",\n    \"aria-label\": \"prometheus receiver configurations permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Prometheus Receiver Configurations\"), mdx(\"p\", null, \"The Prometheus Receiver provides many configurations to perform service discovery, metric scraping, and metric re-labelling.\"), mdx(\"p\", null, \"Note that each of these configurations requires its own Role-Based Access Control (RBAC) permissions in order to access the kube-api and\\ndiscover scrape targets. These requirements can be found \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#permissions\"\n  }, \"here\"), \".\"), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"additional-kuberneteseks-scraping-configurations\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#additional-kuberneteseks-scraping-configurations\",\n    \"aria-label\": \"additional kuberneteseks scraping configurations permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Additional Kubernetes/EKS Scraping Configurations\"), mdx(\"p\", null, \"To monitor your Kubernetes applications and clusters, we specifically use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"kubernetes_sd_configs\"), \". We can choose between various Kubernetes\\nobjects to discover and scrape including endpoints, pods, nodes, services and ingresses. For each of these objects, we provide a default configuration.\"), mdx(\"h4\", {\n    \"id\": \"endpoints\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h4\",\n    \"href\": \"#endpoints\",\n    \"aria-label\": \"endpoints permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Endpoints\"), mdx(\"p\", null, \"The Prometheus Receiver monitors each applications deployment using the service endpoints. Specifically, it scrapes and collects metrics from the\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/metrics\"), \" endpoint. In order to create and expose these metrics, we use the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://prometheus.io/docs/instrumenting/clientlibs/\"\n  }, \"Prometheus client libraries\"), \".\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"- job_name: 'kubernetes-service-endpoints'\\n  kubernetes_sd_configs:\\n  - role: endpoints\\n\\n  relabel_configs:\\n  # Example relabel to scrape only endpoints that have\\n  # \\\"prometheus.io/scrape = true\\\" annotation.\\n  # - action: keep\\n  #   regex: true\\n  #   source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]\\n  # Example relabel to configure scrape scheme for all service scrape targets\\n  # based on endpoints \\\"prometheus.io/scrape_scheme = <scheme>\\\" annotation.\\n  # - action: replace\\n  #   regex: (https?)\\n  #   source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]\\n  #   target_label: __scheme__\\n  # Example relabel to customize metric path based on endpoints\\n  # \\\"prometheus.io/path = <metric path>\\\" annotation.\\n  # - action: replace\\n  #   regex: (.+)\\n  #   source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]\\n  #   target_label: __metrics_path__\\n  # Example relabel to scrape only single, desired port for the service based\\n  # on endpoints \\\"prometheus.io/scrape_port = <port>\\\" annotation.\\n  # - action: replace\\n  #   regex: ([^:]+)(?::\\\\d+)?;(\\\\d+)\\n  #   replacement: $$1:$$2\\n  #   source_labels: [__address__,__meta_kubernetes_service_annotation_prometheus_io_port]\\n  #   target_label: __address__\\n  - action: labelmap\\n    regex: __meta_kubernetes_pod_label_(.+)      \\n  - action: replace\\n    source_labels: [__meta_kubernetes_namespace]\\n    target_label: Namespace\\n  - action: replace\\n    source_labels: [__meta_kubernetes_service_name]\\n    target_label: Service\\n  - action: replace\\n    source_labels: [__meta_kubernetes_pod_node_name]\\n    target_label: kubernetes_node\\n  - action: replace\\n    source_labels: [__meta_kubernetes_pod_name]\\n    target_label: pod_name\\n  - action: replace\\n    source_labels: [__meta_kubernetes_pod_container_name]\\n    target_label: container_name\\n\\n  # Exclude high cardinality metrics\\n  metric_relabel_configs:\\n  - source_labels: [__name__]\\n    regex: 'go_gc_duration_seconds.*'\\n    action: drop\\n\")), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"pods\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#pods\",\n    \"aria-label\": \"pods permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Pods\"), mdx(\"p\", null, \"A pod is a group of one or more containers, with shared storage/network resources, and a specification for how to run the containers.\\nWhen monitoring pods, we want to watch the pod deployment patterns, total pod instances, and expected vs. actual pod instances.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"- job_name: 'kubernetes-pods'\\n  sample_limit: 10000\\n  kubernetes_sd_configs:\\n  - role: pod\\n  relabel_configs:\\n  # Example relabel to scrape only endpoints that have\\n  # \\\"prometheus.io/scrape = true\\\" annotation.\\n  # - action: keep\\n  #  regex: true\\n  #  source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]\\n  # Example relabel to configure scrape scheme for all service scrape targets\\n  # based on endpoints \\\"prometheus.io/scrape_scheme = <scheme>\\\" annotation.\\n  # - action: replace\\n  #  regex: (https?)\\n  #  source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]\\n  #  target_label: __scheme__\\n  # Example relabel to customize metric path based on endpoints\\n  # \\\"prometheus.io/path = <metric path>\\\" annotation.\\n  # - action: replace\\n  #  regex: (.+)\\n  #  source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]\\n  #  target_label: __metrics_path__\\n  # Example relabel to scrape only single, desired port for the service based\\n  # on endpoints \\\"prometheus.io/scrape_port = <port>\\\" annotation.\\n  # - action: labelmap\\n  #  regex: __meta_kubernetes_pod_label_(.+)\\n  - action: replace\\n    source_labels: [__meta_kubernetes_namespace]\\n    target_label: Namespace\\n  - action: replace\\n    source_labels: [__meta_kubernetes_pod_name]\\n    target_label: pod_name\\n  - action: replace\\n    source_labels: [__meta_kubernetes_pod_container_name]\\n    target_label: container_name\\n  - action: replace\\n    source_labels: [__meta_kubernetes_pod_controller_name]\\n    target_label: pod_controller_name\\n  - action: replace\\n    source_labels: [__meta_kubernetes_pod_controller_kind]\\n    target_label: pod_controller_kind\\n  - action: replace\\n    source_labels: [__meta_kubernetes_pod_phase]\\n    target_label: pod_phase\\n\\n  metric_relabel_configs:\\n  - action: drop\\n    source_labels: [__name__]\\n    regex: 'go_gc_duration_seconds.*'\\n\")), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"kubernetes-k8s-api-server\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#kubernetes-k8s-api-server\",\n    \"aria-label\": \"kubernetes k8s api server permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Kubernetes (k8s) API Server\"), mdx(\"p\", null, \"The \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/\"\n  }, \"kube-apiserver\"), \" provides REST operations and the\\nfront-end to the cluster\\u2019s shared state through which all other components interact. Key metrics to watch for include: the number and\\nduration of requests for each combination of resource (including pods, Deployments, etc.) as well as the operation (such as GET, LIST, POST, DELETE).\"), mdx(\"p\", null, \"The TLS configurations give us access to the k8s objects.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"- job_name: 'kubernetes-apiservers'\\n  sample_limit: 10000\\n  # Default to scraping over https. If required, just disable this or change to\\n  # `http`.\\n  scheme: https\\n  \\n  kubernetes_sd_configs:\\n  - role: endpoints\\n  tls_config:\\n    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\n    insecure_skip_verify: true\\n  bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\\n  \\n  relabel_configs:\\n  - source_labels: [__meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]\\n    action: keep\\n    regex: kubernetes;https\\n\")), mdx(\"p\", null, \"Some types of metrics we can receive from the API server include:\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Metric\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Description\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Metric Type\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"apiserver\", \"_\", \"request\", \"_\", \"duration\", \"_\", \"seconds\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Count of requests to the API server for a specific resource and verb\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Work: Throughput\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"workqueue\", \"_\", \"queue\", \"_\", \"duration\", \"_\", \"seconds\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Total number of seconds that items spent waiting in a specific work queue\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Work: Performance\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"workqueue\", \"_\", \"work\", \"_\", \"duration\", \"_\", \"seconds\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Total number of seconds spent processing items in a specific work queue\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Work: Performance\")))), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"cadvisor\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#cadvisor\",\n    \"aria-label\": \"cadvisor permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"cAdvisor\"), mdx(\"p\", null, \"The cAdvisor is an agent integrated into the kubelet binary to monitor the resource usage and analyze the performance of \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"containers\"), \".\\nKey metrics collected by the cAdvisor include the CPU, memory, file, and network usage for containers running on a given node.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"- job_name: 'kubernetes-cadvisor'\\n  sample_limit: 10000\\n  # Default to scraping over https. If required, just disable this or change to\\n  # `http`.\\n  scheme: https\\n  metrics_path: /metrics/cadvisor\\n  \\n  kubernetes_sd_configs:\\n  - role: node\\n  tls_config:\\n    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\n    insecure_skip_verify: true\\n  bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\\n  \\n  relabel_configs:\\n    - action: labelmap\\n      regex: __meta_kubernetes_node_label_(.+)\\n\")), mdx(\"p\", null, \"Types of metrics we can receive from the cAdvisor include:\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Metric\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Description\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"container\", \"_\", \"cpu\", \"_\", \"load\", \"_\", \"average\", \"_\", \"10s\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Value of container cpu load average over the last 10 seconds.\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"container\", \"_\", \"cpu\", \"_\", \"system\", \"_\", \"seconds\", \"_\", \"total\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Cumulative system cpu time consumed in seconds.\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"container\", \"_\", \"last\", \"_\", \"seen\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Last time a container was seen by the exporter\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"container\", \"_\", \"memory\", \"_\", \"failcnt\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Number of memory usage hits limits\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"container\", \"_\", \"memory\", \"_\", \"failures\", \"_\", \"total\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Cumulative count of memory allocation failures.\")))), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"nodes\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#nodes\",\n    \"aria-label\": \"nodes permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Nodes\"), mdx(\"p\", null, \"Kubernetes nodes are the virtual or physical machines that run our workloads. Key metrics to watch for nodes\\nmainly report on resource utilization including allocatable memory/CPU and CPU/disk utilization.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"- job_name: 'kubernetes-nodes'\\n  sample_limit: 10000\\n  # Default to scraping over https. If required, just disable this or change to\\n  # `http`.\\n  scheme: https\\n  \\n  kubernetes_sd_configs:\\n  - role: node\\n  tls_config:\\n    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\n    insecure_skip_verify: true\\n  bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\\n  \\n  relabel_configs:\\n    - action: labelmap\\n      regex: __meta_kubernetes_node_label_(.+)\\n\")), mdx(\"p\", null, \"Types of metrics we receive from the cAdvisor include:\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Metric\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Description\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"kubelet\", \"_\", \"cgroup\", \"_\", \"manager\", \"_\", \"duration\", \"_\", \"seconds\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Duration in seconds for cgroup manager operations. Broken down by method.\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"kubelet\", \"_\", \"node\", \"_\", \"config\", \"_\", \"error\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"This metric is true (1) if the node is experiencing a configuration-related error, false (0) otherwise.\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"kubelet\", \"_\", \"pleg\", \"_\", \"relist\", \"_\", \"duration\", \"_\", \"seconds\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Duration in seconds for relisting pods in PLEG (pod lifecycle event generator).\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"kubelet\", \"_\", \"pod\", \"_\", \"start\", \"_\", \"duration\", \"_\", \"seconds\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Duration in seconds for a single pod to go from pending to running.\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"kubelet\", \"_\", \"pod\", \"_\", \"worker\", \"_\", \"duration\", \"_\", \"seconds\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Duration in seconds to sync a single pod. Broken down by operation type: create, update, or sync\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"kubelet\", \"_\", \"running\", \"_\", \"pod\", \"_\", \"count\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Number of pods currently running\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"kubelet\", \"_\", \"runtime\", \"_\", \"operations\", \"_\", \"duration\", \"_\", \"seconds\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Duration in seconds of runtime operations. Broken down by operation type.\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"kubelet\", \"_\", \"runtime\", \"_\", \"operations\", \"_\", \"errors\", \"_\", \"total\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Cumulative number of runtime operation errors by operation type. This can be a good indicator of low level issues in the node, like problems with container runtime.\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"kubelet\", \"_\", \"runtime\", \"_\", \"operations\", \"_\", \"total\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Total count of runtime operations of each type.\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"storage\", \"_\", \"operation\", \"_\", \"duration\", \"_\", \"seconds\", \"_\", \"count\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Storage operation duration\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"storage\", \"_\", \"operation\", \"_\", \"errors\", \"_\", \"total\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Storage operation errors\")))), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"services\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#services\",\n    \"aria-label\": \"services permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Services\"), mdx(\"p\", null, \"A service is an abstract way to expose an application running on a set of pods as a network service. The services define a logical set of pods\\nand a policy by which to access them, enabling decoupling between pods. The important metrics to consider for services is the health of that\\nservice. We can use the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/prometheus/blackbox_exporter\"\n  }, \"Blackbox Exporter provided by Prometheus\"), \" to probe endpoints over HTTP, HTTPS, DNS, TCP and ICMP. \"), mdx(\"h4\", {\n    \"id\": \"prerequisite\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h4\",\n    \"href\": \"#prerequisite\",\n    \"aria-label\": \"prerequisite permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Prerequisite\"), mdx(\"p\", null, \"To use the blackbox exporter, ** we can deploy the configurations\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/aws-observability/aws-otel-collector/blob/main/examples/eks/aws-prometheus/prometheus-blackbox-exporter.yaml\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"Using the name of the Blackbox Exporter service and the exposed port (9115), we can access the probed metrics. This is done by\\nreplacing the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"__address__\"), \". If we do not want to probe all services, we can specify a list of target addresses to probe in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"static_configs\"), \"\\n(more information can be found \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://prometheus.io/docs/prometheus/latest/configuration/configuration/\"\n  }, \"here\"), \").\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"- job_name: 'kubernetes-services'\\n  sample_limit: 10000\\n  metrics_path: /probe\\n  params:\\n    module: [http_2xx]\\n    \\n  kubernetes_sd_configs:\\n  - role: service\\n  \\n  relabel_configs:\\n  # Example relabel to probe only some services that have \\\"prometheus.io/should_be_probed = true\\\" annotation\\n  # - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_should_be_probed]\\n  #  action: keep\\n  #  regex: true\\n  - source_labels: [__address__]\\n    target_label: __param_target\\n  - target_label: __address__\\n    replacement: blackbox-exporter-service:9115\\n  - source_labels: [__param_target]\\n    target_label: instance\\n  - action: labelmap\\n    regex: __meta_kubernetes_service_label_(.+)\\n  - source_labels: [__meta_kubernetes_namespace]\\n    target_label: kubernetes_namespace\\n  - source_labels: [__meta_kubernetes_service_name]\\n    target_label: kubernetes_name\\n\")), mdx(\"p\", null, \"Some types of metrics we can receive from the service probing include:\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Metric\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Description\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"probe\", \"_\", \"duration\", \"_\", \"seconds\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Returns how long the probe took to complete in seconds\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"probe\", \"_\", \"http\", \"_\", \"status\", \"_\", \"code\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Response HTTP status code\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"probe\", \"_\", \"http\", \"_\", \"uncompressed\", \"_\", \"body\", \"_\", \"length\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Length of uncompressed response body\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"probe\", \"_\", \"success\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Displays whether or not the probe was a success\")))), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"ingresses\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#ingresses\",\n    \"aria-label\": \"ingresses permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Ingresses\"), mdx(\"p\", null, \"A Kubernetes ingress is an API object that manages external access to the services in a cluster. Similar to services, the important metrics to\\nconsider is the health of the ingress. We can use the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/prometheus/blackbox_exporter\"\n  }, \"Blackbox Exporter provided by Prometheus\"), \"\\nto probe endpoints over HTTP, HTTPS, DNS, TCP and ICMP. \"), mdx(\"p\", null, \"As setup in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"services\"), \", this will also require the Blackbox Exporter.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"- job_name: 'kubernetes-ingresses'\\n  sample_limit: 10000\\n  metrics_path: /probe\\n  params:\\n    module: [http_2xx]\\n\\n  kubernetes_sd_configs:\\n  - role: ingress\\n  \\n  relabel_configs:\\n  # Example relabel to probe only some services that have \\\"prometheus.io/should_be_probed = true\\\" annotation\\n  # - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_should_be_probed]\\n  #  action: keep\\n  #  regex: true\\n  - source_labels: [__meta_kubernetes_ingress_scheme,__address__,__meta_kubernetes_ingress_path]\\n    regex: (.+);(.+);(.+)\\n    replacement: $${1}://$${2}$${3}\\n    target_label: __param_target\\n  - target_label: __address__\\n    replacement: blackbox-exporter-service:9115\\n  - source_labels: [__param_target]\\n    target_label: instance\\n  - action: labelmap\\n    regex: __meta_kubernetes_ingress_label_(.+)\\n  - source_labels: [__meta_kubernetes_namespace]\\n    target_label: kubernetes_namespace\\n  - source_labels: [__meta_kubernetes_ingress_name]\\n    target_label: kubernetes_name\\n\")), mdx(\"p\", null, \"Some types of metrics that we can receive from the service probing include:\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Metric\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Description\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"probe\", \"_\", \"duration\", \"_\", \"seconds\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Returns how long the probe took to complete in seconds\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"probe\", \"_\", \"http\", \"_\", \"status\", \"_\", \"code\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Response HTTP status code\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"probe\", \"_\", \"http\", \"_\", \"uncompressed\", \"_\", \"body\", \"_\", \"length\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Length of uncompressed response body\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"probe\", \"_\", \"success\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Displays whether or not the probe was a success\")))), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Notice that these metrics are similar to the service metrics above (as they are both probing metrics). The difference will lie in the labels.\")), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"permissions\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#permissions\",\n    \"aria-label\": \"permissions permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Permissions\"), mdx(\"h3\", {\n    \"id\": \"kubernetes-api-server\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#kubernetes-api-server\",\n    \"aria-label\": \"kubernetes api server permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Kubernetes API Server\"), mdx(\"p\", null, \"If you are scraping for kube-system components and the API server, the endpoints need to be enabled for private access. More information\\non this can be found \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html#cluster-endpoint-access-console\"\n  }, \"here\"), \". \"), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"rbac-for-other-kubernetes-resources\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#rbac-for-other-kubernetes-resources\",\n    \"aria-label\": \"rbac for other kubernetes resources permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"RBAC for Other Kubernetes Resources\"), mdx(\"p\", null, \"In order for service discovery and scraping to work, the ADOT Collector pod may need permissions to get and list objects of the EKS cluster.\\nBy default, the OTel Collector uses the default service account to communicate with the API server. We can set a ClusterRoleBinding for this\\nservice account such that it can access and scrape the necessary metric endpoints.\"), mdx(\"p\", null, \"Example configuration:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-lineNumbers=true\"\n  }, \"---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRoleBinding\\nmetadata:\\n  name: otelcol-rbac\\nsubjects:\\n- kind: ServiceAccount\\n  name: default\\n  namespace: otelcol\\nroleRef:\\n  kind: ClusterRole\\n  name: cluster-admin\\n  apiGroup: rbac.authorization.k8s.io\\n---\\n\")), mdx(\"p\", null, \"If necessary, we can restrict the service account access to the specific Kubernetes resources we want to scrape. For instance, if we were\\nspecifically scraping for pod-level metrics, we could use the following ClusterRole and ClusterRoleBinding:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-lineNumbers=true\"\n  }, \"---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRole\\nmetadata:\\n  name: prom-admin\\nrules:\\n- apiGroups: [\\\"\\\"]\\n  resources: [\\\"pods\\\"]\\n  verbs: [\\\"get\\\", \\\"watch\\\", \\\"list\\\"]\\n- nonResourceURLs:\\n  - /metrics\\n  verbs:\\n  - get\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRoleBinding\\nmetadata:\\n  name: prom-rbac\\nsubjects:\\n- kind: ServiceAccount\\n  name: default\\n  namespace: otelcol\\nroleRef:\\n  kind: ClusterRole\\n  name: prom-admin\\n  apiGroup: rbac.authorization.k8s.io\\n---\\n\")), mdx(\"p\", null, \"To scrape Node or cAdvisor metrics, we need to provide the service account access to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"nodes/metrics\"), \". As an example,\\nthe following ClusterRole and ClusterRoleBinding should work for Pod, Node, Service, and cAdvisor metrics. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-lineNumbers=true\"\n  }, \"---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRole\\nmetadata:\\n  name: prom-admin\\nrules:\\n- apiGroups: [\\\"\\\"]\\n  resources:\\n    - nodes\\n    - nodes/proxy\\n    - nodes/metrics\\n    - services\\n    - endpoints\\n    - pods\\n  verbs: [\\\"get\\\", \\\"list\\\", \\\"watch\\\"]\\n- nonResourceURLs:\\n  - /metrics\\n  verbs:\\n  - get\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRoleBinding\\nmetadata:\\n  name: prom-rbac\\nsubjects:\\n- kind: ServiceAccount\\n  name: default\\n  namespace: otelcol\\nroleRef:\\n  kind: ClusterRole\\n  name: prom-admin\\n  apiGroup: rbac.authorization.k8s.io\\n---\\n\")), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"prometheus-remote-write-exporter-configurations\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#prometheus-remote-write-exporter-configurations\",\n    \"aria-label\": \"prometheus remote write exporter configurations permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Prometheus Remote Write Exporter Configurations\"), mdx(\"p\", null, \"For the Prometheus Remote Write Exporter to sign your HTTP requests with AWS SigV4 (AWS\\u2019 authentication protocol for secure authentication),\\nyou will need to provide the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"auth\"), \" configuration with the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"sigv4auth\"), \" authenticator. If \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"auth\"), \" is not provided, HTTPs requests will not be signed.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"extensions:\\n  sigv4auth:\\n    service: \\\"aps\\\"\\n    region: \\\"user-region\\\"\\nexporters:\\n  prometheusremotewrite:\\n    endpoint: \\\"https://aws-managed-prometheus-endpoint/v1/api/remote_write\\\"\\n    auth:\\n      authenticator: sigv4auth\\n\")), mdx(\"p\", null, \"Aside from the auth configurations, the Prometheus Remote Write Exporter is also configurable with retry, sending queue, and timeout\\nsettings. An example of these configurations is provided below.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }, \"extensions:\\n  sigv4auth:\\n    service: \\\"aps\\\"\\n    region: \\\"us-east-1\\\"\\nexporters:\\n  prometheusremotewrite:\\n    endpoint: \\\"https://aps-workspaces-gamma.us-east-1.amazonaws.com/workspaces/ws-7cd45747-2381-4a2a-847f-fa61a3694a74/api/v1/remote_write\\\"\\n    namespace: test\\n    auth:\\n      authenticator: sigv4auth\\n    retry_on_failure:\\n      enabled: true\\n      initial_interval: 5s\\n      max_interval: 10s\\n      max_elabsed_time: 30s\\n    timeout: 15s\\n\")), mdx(\"p\", null, \"More information on the possible retry, sending queue, and timeout configurations can be found\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/open-telemetry/opentelemetry-collector/tree/master/exporter/exporterhelper#configuration\"\n  }, \"here\"), \". \"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"takeaway\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#takeaway\",\n    \"aria-label\": \"takeaway permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Takeaway\"), mdx(\"p\", null, \"These advanced configurations should enable you to monitor your applications and Kubernetes cluster in a secure and reliable manner.\\nIf you would like a more basic setup, please take a look at the\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/docs/getting-started/prometheus-remote-write-exporter\"\n  }, \"getting started with the AWS Distro for OpenTelemetry Collector-AMP Pipeline in EKS Guide\"), \".\"), mdx(\"p\", null, \"We would love to hear more common configuration scenarios or improvements to this documentation from you! Please submit an issue\\non the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/aws-observability/aws-otel-community\"\n  }, \"aws-otel community\"), \" to let us know.\"));\n}\n;\nMDXContent.isMDXComponent = true;","headings":[{"depth":2,"value":"Prometheus Receiver Configurations"},{"depth":3,"value":"Additional Kubernetes/EKS Scraping Configurations"},{"depth":4,"value":"Endpoints"},{"depth":3,"value":"Pods"},{"depth":3,"value":"Kubernetes (k8s) API Server"},{"depth":3,"value":"cAdvisor"},{"depth":3,"value":"Nodes"},{"depth":3,"value":"Services"},{"depth":4,"value":"Prerequisite"},{"depth":3,"value":"Ingresses"},{"depth":2,"value":"Permissions"},{"depth":3,"value":"Kubernetes API Server"},{"depth":3,"value":"RBAC for Other Kubernetes Resources"},{"depth":2,"value":"Prometheus Remote Write Exporter Configurations"},{"depth":2,"value":"Takeaway"}]}},"pageContext":{"slug":"/docs/getting-started/advanced-prometheus-remote-write-configurations/","repositoryEditUrl":"https://github.com/rocketseat/gatsby-themes/tree/main/examples/gatsby-theme-docs/src/docs/getting-started/advanced-prometheus-remote-write-configurations.mdx","repositoryProvider":"GitHub"}},
    "staticQueryHashes": ["2501019404","973074209"]}