{
    "componentChunkName": "component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js",
    "path": "/docs/migrating-to-collector-v0.35.0",
    "result": {"data":{"mdx":{"id":"09cfc492-57a1-5655-9601-2ebbc56b28cf","excerpt":"What is happening? Starting with version v0.85.0 of the upstream OpenTelemetry collector, the normalization of metrics when converting from OpenTelemetryâ€¦","fields":{"slug":"/docs/migrating-to-collector-v0.35.0/"},"frontmatter":{"title":"Migration guide for the ADOT collector v0.35.0 - Prometheus exporters","description":"This blog post describes the process of migrating to the ADOT collector v0.35.0. This guide is necessary due to upcoming breaking changes present in the Prometheus exporter and Prometheus remote write exporter components.","image":null,"disableTableOfContents":null},"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"Migration guide for the ADOT collector v0.35.0 - Prometheus exporters\",\n  \"description\": \"This blog post describes the process of migrating to the ADOT collector v0.35.0. This guide is necessary due to upcoming breaking changes present in the Prometheus exporter and Prometheus remote write exporter components.\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", {\n    \"id\": \"what-is-happening\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#what-is-happening\",\n    \"aria-label\": \"what is happening permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"What is happening?\"), mdx(\"p\", null, \"Starting with version v0.85.0 of the upstream OpenTelemetry collector, the normalization of metrics when converting from OpenTelemetry metrics to Prometheus will be enabled by default.\"), mdx(\"h2\", {\n    \"id\": \"when-will-this-happen\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#when-will-this-happen\",\n    \"aria-label\": \"when will this happen permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"When will this happen?\"), mdx(\"p\", null, \"The ADOT collector will start adopting the upstream behavior for name normalization of Prometheus metrics on version v0.35.0.\"), mdx(\"h2\", {\n    \"id\": \"who-is-affected-and-what-to-expect\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#who-is-affected-and-what-to-expect\",\n    \"aria-label\": \"who is affected and what to expect permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Who is affected and what to expect?\"), mdx(\"p\", null, \"You are affected if you are using one of the following components present in the ADOT collector: \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/prometheusexporter#prometheus-exporter\"\n  }, \"prometheus exporter\"), \" and \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/exporter/prometheusremotewriteexporter#prometheus-remote-write-exporter\"\n  }, \"prometheus remote write exporter\"), \".\"), mdx(\"p\", null, \"If you don\\u2019t do anything, the name of the metrics exported by the collector using these components will be normalized according to well defined rules \", \"[1,2]\", \". These rules are applied so best practices are applied to the naming of metrics \", \"[3]\", \".\"), mdx(\"p\", null, \"Notably the following changes will enter in effect:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The unit of the metrics will be appended as suffix to the metrics exported by Prometheus.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Counters will have a \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"_total\"), \" suffix.\")), mdx(\"p\", null, \"Examples:\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Type\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Name\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Unit\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Prometheus Metric exported\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Gauge\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"system.filesystem.usage\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"By\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"system_filesystem_usage_bytes\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Gauge\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"system.network.dropped\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"packets\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"system_network_dropped_packets\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Counter\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"system.network.dropped\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"packets\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"system_network_dropped_packets_total\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Gauge\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"system.cpu.utilization\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"system_cpu_utilization_ratio\")))), mdx(\"p\", null, \"The feature gate \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pkg.translator.prometheus.NormalizeName\"), \" is  used to control the normalization behavior. If the feature gate is disabled, there won\\u2019t be name normalization. Besides that, both components added a configuration option to control the normalization behaviour in the component level, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"add_metric_suffixes\"), \" property. This configuration option is only honoured if the feature gate is enabled.\"), mdx(\"p\", null, \"In the ADOT collector v0.34.0, the feature gate \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pkg.translator.prometheus.NormalizeName\"), \" is disabled by default. In the collector v0.35.0, this feature gate will be enabled by default.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"[1]\", \" \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/pkg/translator/prometheus\"\n  }, \"https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/pkg/translator/prometheus\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"[2]\", \" \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/compatibility/prometheus_and_openmetrics.md#metric-metadata-1\"\n  }, \"https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/compatibility/prometheus_and_openmetrics.md#metric-metadata-1\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"[3]\", \" \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://prometheus.io/docs/practices/naming/\"\n  }, \"https://prometheus.io/docs/practices/naming/\"))), mdx(\"h2\", {\n    \"id\": \"what-action-items-do-i-need-to-take\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#what-action-items-do-i-need-to-take\",\n    \"aria-label\": \"what action items do i need to take permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"What action items do I need to take?\"), mdx(\"h3\", {\n    \"id\": \"if-you-want-to-upgrade-to-the-adot-collector-v0350-without-name-normalization\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#if-you-want-to-upgrade-to-the-adot-collector-v0350-without-name-normalization\",\n    \"aria-label\": \"if you want to upgrade to the adot collector v0350 without name normalization permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"If you want to upgrade to the ADOT collector v0.35.0 without name normalization\"), mdx(\"p\", null, \"This path is recommended for users who want to retain the metrics names unchanged after upgrading to the ADOT collector v0.35.0. This will guarantee that dashboards and alarms remain functional after the upgrade. \"), mdx(\"p\", null, \"The following step by step guide is provided to guarantee a safe and gradual migration.\"), mdx(\"p\", null, \"Steps:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Upgrade the ADOT collector to v0.34.0.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Modify/review the collector configuration for the components Prometheus remote write exporter and Prometheus exporter. They \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"must\"), \" add the property \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"add_metric_suffixes: false\"), \"  to the configuration section of these components.\\nExample:\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"  prometheusremotewrite:\\n    endpoint: http://example.com\\n    add_metric_suffixes: false  # <-- Disable normalization\\n    resource_to_telemetry_conversion:\\n      enabled: true\\n    auth:\\n      authenticator: sigv4auth\\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"exporters:\\n  prometheus:\\n    endpoint: \\\"1.2.3.4:1234\\\"\\n    namespace: test-space\\n    const_labels:\\n      label1: value1\\n      \\\"another label\\\": spaced value\\n    send_timestamps: true\\n    metric_expiration: 180m\\n    enable_open_metrics: true\\n    add_metric_suffixes: false  # <-- Disable normalization\\n    resource_to_telemetry_conversion:\\n      enabled: true\\n\")), mdx(\"ol\", {\n    \"start\": 3\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Upgrade the ADOT collector to v0.35.0.\")), mdx(\"h3\", {\n    \"id\": \"if-you-recently-upgraded-to-adot-collector-v0350\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#if-you-recently-upgraded-to-adot-collector-v0350\",\n    \"aria-label\": \"if you recently upgraded to adot collector v0350 permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"If you recently upgraded to ADOT collector v0.35.0\"), mdx(\"p\", null, \"This path is recommended for users that are already using the ADOT collector v0.35.0. The following steps are recommended:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If you want to keep metric names as collected by the ADOT collector, e.g. untransformed, you should modify/review the collector configuration for the components Prometheus remote write exporter and Prometheus exporter. You \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"must\"), \" have the property \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"add_metric_suffixes: false\"), \"  in the configuration section of these components.\")), mdx(\"p\", null, \"Example:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"  prometheusremotewrite:\\n    endpoint: http://example.com\\n    add_metric_suffixes: false  # <-- Disable normalization\\n    resource_to_telemetry_conversion:\\n      enabled: true\\n    auth:\\n      authenticator: sigv4auth\\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"exporters:\\n  prometheus:\\n    endpoint: \\\"1.2.3.4:1234\\\"\\n    namespace: test-space\\n    const_labels:\\n      label1: value1\\n      \\\"another label\\\": spaced value\\n    send_timestamps: true\\n    metric_expiration: 180m\\n    enable_open_metrics: true\\n    add_metric_suffixes: false  # <-- Disable normalization\\n    resource_to_telemetry_conversion:\\n      enabled: true\\n\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If you want to use the name normalization of Prometheus metrics, you don\\u2019t need to do anything. We highly recommend that you verify that queries reference the normalized metric names.\")));\n}\n;\nMDXContent.isMDXComponent = true;","headings":[{"depth":2,"value":"What is happening?"},{"depth":2,"value":"When will this happen?"},{"depth":2,"value":"Who is affected and what to expect?"},{"depth":2,"value":"What action items do I need to take?"},{"depth":3,"value":"If you want to upgrade to the ADOT collector v0.35.0 without name normalization"},{"depth":3,"value":"If you recently upgraded to ADOT collector v0.35.0"}]}},"pageContext":{"slug":"/docs/migrating-to-collector-v0.35.0/","repositoryEditUrl":"https://github.com/rocketseat/gatsby-themes/tree/main/examples/gatsby-theme-docs/src/docs/migrating-to-collector-v0.35.0.mdx","repositoryProvider":"GitHub"}},
    "staticQueryHashes": ["2501019404","973074209"]}